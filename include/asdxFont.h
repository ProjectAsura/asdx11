//-----------------------------------------------------------------------------
// File : asdxFont.h
// Desc : Font Rasterizer.
// Copyright(c) Project Asura. All right reserved.
//-----------------------------------------------------------------------------
#pragma once


//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include <cstdint>
#include <vector>
#include <d3d11.h>
#include <asdxRef.h>


namespace asdx {

///////////////////////////////////////////////////////////////////////////////
// Font class
///////////////////////////////////////////////////////////////////////////////
class Font
{
    //=========================================================================
    // list of friend classes and methods.
    //=========================================================================
    /* NOTHING */

public:
    ///////////////////////////////////////////////////////////////////////////
    // Bitmap structure
    ///////////////////////////////////////////////////////////////////////////
    struct Bitmap
    {
        uint32_t                Width;      // 横幅.
        uint32_t                Height;     // 縦幅.
        std::vector<uint8_t>    Pixels;     // DXGI_FORMAT_R8_UNORMのピクセルデータ.

        void Resize()
        { Pixels.resize(size_t(Width) * size_t(Height)); }

        void Clear()
        {
            Pixels.clear();
            Pixels.shrink_to_fit();
        }

        operator uint8_t* ()
        { return Pixels.data(); }

        operator const uint8_t* () const
        { return Pixels.data(); }
    };

    //=========================================================================
    // public variables.
    //=========================================================================
    /* NOTHING */

    //=========================================================================
    // public methods.
    //=========================================================================

    //-------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //-------------------------------------------------------------------------
    Font();

    //-------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //-------------------------------------------------------------------------
    ~Font();

    //-------------------------------------------------------------------------
    //! @brief      初期化処理を行います.
    //-------------------------------------------------------------------------
    bool Init(const char* path, float fontSize);

    //-------------------------------------------------------------------------
    //! @brief      終了処理を行います.
    //-------------------------------------------------------------------------
    void Term();

    //-------------------------------------------------------------------------
    //! @brief      ラスタライズに必要なサイズを求めます.
    //-------------------------------------------------------------------------
    void CalcSize(const wchar_t* text, uint32_t& w, uint32_t& h) const;

    //-------------------------------------------------------------------------
    //! @brief      ラスタライズに必要なサイズを求めます.
    //-------------------------------------------------------------------------
    void CalcSize(const char* text, uint32_t& w, uint32_t& h) const;

    //-------------------------------------------------------------------------
    //! @brief      ラスタライズ処理を行います.
    //-------------------------------------------------------------------------
    Bitmap Rasterize(const wchar_t* text) const;

    //-------------------------------------------------------------------------
    //! @brief      ラスタライズ処理を行います.
    //-------------------------------------------------------------------------
    Bitmap Rasterize(const char* text) const;

    //-------------------------------------------------------------------------
    //! @brief      指定されたメモリにラスタライズを行います.
    //-------------------------------------------------------------------------
    void Rasterize(Bitmap& bitmap, const wchar_t* text) const;

    //-------------------------------------------------------------------------
    //! @brief      指定されたメモリにラスタライズを行います.
    //-------------------------------------------------------------------------
    void Rasterize(Bitmap& bitmap, const char* text) const;


private:
    //=========================================================================
    // private variables.
    //=========================================================================
    struct Body;
    Body*  m_pBody;

    //=========================================================================
    // private methods.
    //=========================================================================
    /* NOTHING */
};

} // namespace asdx
